<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="styles.css">
    <title>Create Password</title>
    <script>
        function verify(){
            let pass = document.getElementById("pass").value;
            let confpass = document.getElementById("confpass").value;
            let error = document.getElementById("error");

            console.log(pass);
            console.log(confpass);

            if (pass != confpass) {
                error.classList.remove("hide");
                error.textContent = "Passwords do not match.";
            }
            else {
                error.classList.add("hide");
                error.textContent = getData(pass);
            }
        }

        function getData(password) {
            let URL1 = "./cgi-bin/verify_password.py";
            let URL2 = "";
            let params = {
                "method": "POST",
                "body": JSON.stringify({
                    "username": window.localStorage.getItem("User"),
                    "password": password
                })};

            fetch(URL1, params)
               .then((response) => {
                    return response.json();
               })
               .then((data) => {
                   if (data.error) {
                    return data.error;
                   }
                   else {
                       fetch(URL2, params)
                            .then((response) => {
                                return response.json();
                            }) 
                           then((data) => {
                               if (data.success) {
                                   // TODO: Redirect
                               }
                               else {
                                   // TODO: Error redirect?
                               }
                           }) 
                       // TODO POST to next step
                   }
               }) 
        }
    </script>
</head>

<body>
    <h1>Create Password</h1>
    <div id="passwords">
        <label for="pass">Password</label>
        <input type="password" name="pass" id="pass"> <br>

        <label for="confpass">Confirm Password</label>
        <input type="password" name="confpass" id="confpass"> <br>

        <input type="submit" value="SUBMIT" onclick="verify()">
        
        <p id="error" class="hide"></p>
    </div>
</body>

</html>